# Xiaohongshu Integration - Visual Architecture

## ðŸŽ¨ System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER INTERFACE                                 â”‚
â”‚                    /xiaohongshu (React Page)                            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Backend       â”‚  â”‚   Database     â”‚  â”‚   Activity     â”‚          â”‚
â”‚  â”‚  Health        â”‚  â”‚   Status       â”‚  â”‚   Logs         â”‚          â”‚
â”‚  â”‚  Indicator     â”‚  â”‚   Indicator    â”‚  â”‚   Feed         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              Configuration Form                            â”‚         â”‚
â”‚  â”‚  â€¢ Product Name     â€¢ Post Frequency                      â”‚         â”‚
â”‚  â”‚  â€¢ Target Audience  â€¢ Brand Style                         â”‚         â”‚
â”‚  â”‚  â€¢ Marketing Goal   â€¢ Review Mode                         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Save     â”‚  â”‚   Start    â”‚  â”‚   Pause    â”‚  â”‚   Reset    â”‚      â”‚
â”‚  â”‚   Config   â”‚  â”‚   Auto     â”‚  â”‚   Auto     â”‚  â”‚   Config   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   XiaohongshuAuto-  â”‚
                    â”‚   mationPage.tsx    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                   â”‚                   â”‚
           â†“                   â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   xiaohongshu-   â”‚  â”‚  xiaohongshu     â”‚  â”‚    Supabase      â”‚
â”‚   db.ts          â”‚  â”‚  api.ts          â”‚  â”‚    Auth          â”‚
â”‚  (Database       â”‚  â”‚  (Backend API)   â”‚  â”‚                  â”‚
â”‚   Service)       â”‚  â”‚                  â”‚  â”‚  auth.uid()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â”‚                     â”‚                     â”‚
         â†“                     â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE DATABASE                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xhs_user_mapping                                    â”‚  â”‚
â”‚  â”‚  â€¢ supabase_uuid (PK, auth.uid())                    â”‚  â”‚
â”‚  â”‚  â€¢ xhs_user_id (unique)                              â”‚  â”‚
â”‚  â”‚  â€¢ created_at, updated_at                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xhs_user_profiles                                   â”‚  â”‚
â”‚  â”‚  â€¢ id (PK, UUID)                                     â”‚  â”‚
â”‚  â”‚  â€¢ supabase_uuid (unique, FK to auth.users)         â”‚  â”‚
â”‚  â”‚  â€¢ product_name, target_audience                    â”‚  â”‚
â”‚  â”‚  â€¢ marketing_goal, post_frequency                   â”‚  â”‚
â”‚  â”‚  â€¢ brand_style, review_mode                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xhs_automation_status                               â”‚  â”‚
â”‚  â”‚  â€¢ supabase_uuid (PK, auth.uid())                    â”‚  â”‚
â”‚  â”‚  â€¢ is_running, is_logged_in, has_config             â”‚  â”‚
â”‚  â”‚  â€¢ last_activity, uptime_seconds                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xhs_activity_logs                                   â”‚  â”‚
â”‚  â”‚  â€¢ id (PK, UUID)                                     â”‚  â”‚
â”‚  â”‚  â€¢ supabase_uuid (auth.uid())                        â”‚  â”‚
â”‚  â”‚  â€¢ activity_type, message, metadata (JSONB)         â”‚  â”‚
â”‚  â”‚  â€¢ created_at (indexed DESC)                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xhs_daily_tasks                                     â”‚  â”‚
â”‚  â”‚  â€¢ id, theme, title, content                         â”‚  â”‚
â”‚  â”‚  â€¢ scheduled_time, status, post_url                 â”‚  â”‚
â”‚  â”‚  â€¢ image_urls (JSONB), error_message                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xhs_weekly_plans                                    â”‚  â”‚
â”‚  â”‚  â€¢ week_start_date, week_end_date                   â”‚  â”‚
â”‚  â”‚  â€¢ plan_data (JSONB)                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xhs_content_strategies                              â”‚  â”‚
â”‚  â”‚  â€¢ key_themes, trending_topics (JSONB)              â”‚  â”‚
â”‚  â”‚  â€¢ hashtags, optimal_times (JSONB)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  ðŸ”’ RLS: All tables enforce auth.uid() = supabase_uuid     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ (Optional, when available)
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BACKEND API SERVER (Zeabur)                        â”‚
â”‚    xiaohongshu-automation-ai.zeabur.app                     â”‚
â”‚                                                              â”‚
â”‚  GET  /health                    - Health check             â”‚
â”‚  GET  /agent/xiaohongshu/login/status?userId=xxx           â”‚
â”‚  POST /agent/xiaohongshu/auto-login                        â”‚
â”‚  GET  /agent/auto/strategy/{userId}                        â”‚
â”‚  POST /agent/auto/start                                    â”‚
â”‚  GET  /agent/auto/status/{userId}                          â”‚
â”‚  POST /agent/auto/pause                                    â”‚
â”‚  POST /agent/auto/resume                                   â”‚
â”‚  GET  /agent/auto/stats/{userId}                           â”‚
â”‚  GET  /agent/auto/activity/{userId}                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ Data Flow Sequences

### Sequence 1: Initial User Setup

```
User                Frontend              DB Service          Supabase           Backend API
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚â”€â”€Navigate /xhsâ”€â”€â”€â”€â”€>â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Check Authâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                  â”‚
 â”‚                     â”‚<â”€â”€User UUIDâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Generate XHS IDâ”€â”€â”€â”€>â”‚                   â”‚                  â”‚
 â”‚                     â”‚<â”€â”€user_xxx_promeâ”€â”€â”€â”€â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Save Mappingâ”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€INSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Health Checkâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€GET /healthâ”€â”€>â”‚
 â”‚                     â”‚<â”€â”€Offlineâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€Errorâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚<â”€â”€Show Setup UIâ”€â”€â”€â”€â”€â”‚                     â”‚                   â”‚                  â”‚
 â”‚<â”€â”€Warning: Offlineâ”€â”€â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
```

### Sequence 2: Save Configuration (Backend Online)

```
User                Frontend              DB Service          Supabase           Backend API
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚â”€â”€Fill Formâ”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                   â”‚                  â”‚
 â”‚â”€â”€Click Saveâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Save Profileâ”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€UPSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Log Activityâ”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€INSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Start Autoâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€POST /auto/start>â”‚
 â”‚                     â”‚<â”€â”€Runningâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€200 OKâ”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Update Statusâ”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€UPSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚<â”€â”€Toast: Started!â”€â”€â”€â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
```

### Sequence 3: Save Configuration (Backend Offline)

```
User                Frontend              DB Service          Supabase           Backend API
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚â”€â”€Fill Formâ”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                   â”‚                  â”‚
 â”‚â”€â”€Click Saveâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Save Profileâ”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€UPSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Log Activityâ”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€INSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Start Autoâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€POST (timeout)â”€â”€Xâ”‚
 â”‚                     â”‚<â”€â”€Errorâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Update Statusâ”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€UPSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚  (not running)      â”‚                   â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚<â”€â”€Toast: Saved,â”€â”€â”€â”€â”€â”‚                     â”‚                   â”‚                  â”‚
 â”‚   Backend Offline   â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
```

### Sequence 4: Load Existing Configuration

```
User                Frontend              DB Service          Supabase           Backend API
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚â”€â”€Navigate /xhsâ”€â”€â”€â”€â”€>â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Load Profileâ”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Config Dataâ”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€Resultâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Load Statusâ”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Status Dataâ”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€Resultâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Load Activitiesâ”€â”€â”€>â”‚â”€â”€â”€â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Activity Listâ”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€Resultâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚<â”€â”€Show Dashboardâ”€â”€â”€â”€â”‚                     â”‚                   â”‚                  â”‚
 â”‚   (with saved data) â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Health Checkâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€GET /healthâ”€â”€>â”‚
 â”‚                     â”‚<â”€â”€Availableâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€200 OKâ”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Sync Statusâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€GET /status/xxxâ”€>â”‚
 â”‚                     â”‚<â”€â”€Live Dataâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€200 OKâ”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚â”€â”€Update DBâ”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€UPSERTâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
 â”‚                     â”‚<â”€â”€Successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
 â”‚<â”€â”€Refresh UIâ”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                   â”‚                  â”‚
 â”‚   (with live data)  â”‚                     â”‚                   â”‚                  â”‚
 â”‚                     â”‚                     â”‚                   â”‚                  â”‚
```

## ðŸŽ­ State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTOMATION STATES                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Initial   â”‚
    â”‚   Loading   â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Not       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Configured  â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
           â”‚                              â”‚
           â”‚ User fills config            â”‚
           â”‚ Click "Save"                 â”‚ handleResetConfig()
           â†“                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
    â”‚ Config      â”‚                       â”‚
    â”‚ Saved       â”‚                       â”‚
    â”‚ (Not Login) â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
           â”‚                              â”‚
           â”‚ Scan QR code                 â”‚
           â”‚ Login success                â”‚
           â†“                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
    â”‚  Logged In  â”‚                       â”‚
    â”‚  Ready      â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
           â”‚                              â”‚
           â”‚ Click "Start"                â”‚
           â†“                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
    â”‚  Running    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  Active     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Click "Pause"
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Paused     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Click "Resume"
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    (Back to Running)
```

## ðŸ›¡ï¸ Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SECURITY LAYERS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Frontend Authentication Check                      â”‚
â”‚  â€¢ useAuth() hook validates user                            â”‚
â”‚  â€¢ Redirects to /login if not authenticated                 â”‚
â”‚  â€¢ User object contains UUID                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Automatic UUID Association                         â”‚
â”‚  â€¢ All DB operations use user.id (Supabase UUID)            â”‚
â”‚  â€¢ No manual user ID input required                         â”‚
â”‚  â€¢ XHS user ID generated deterministically                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Row Level Security (RLS)                           â”‚
â”‚  â€¢ Enabled on all xhs_* tables                              â”‚
â”‚  â€¢ Policy: supabase_uuid = auth.uid()                       â”‚
â”‚  â€¢ Enforced at database level                               â”‚
â”‚  â€¢ Impossible to bypass from client                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Type Safety                                         â”‚
â”‚  â€¢ TypeScript interfaces for all data                       â”‚
â”‚  â€¢ Compile-time checks                                      â”‚
â”‚  â€¢ No raw SQL in frontend                                   â”‚
â”‚  â€¢ Parameterized queries via Supabase client                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: Each user can ONLY access their own data
        Cross-user data access is impossible
        Admin access requires separate service account
```

---

**Visual Guide Version:** 1.0
**Last Updated:** 2025-10-31
