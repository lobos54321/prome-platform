# ğŸ—ï¸ å¤šç”¨æˆ·æ¶æ„å®Œæ•´æŒ‡å—

## æ¦‚è¿°

æœ¬ç³»ç»Ÿé‡‡ç”¨**å®Œå…¨åç«¯APIé©±åŠ¨**çš„å¤šç”¨æˆ·æ¶æ„ï¼Œæ¯ä¸ªç”¨æˆ·çš„æ•°æ®å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“ã€‚

---

## 1. ç”¨æˆ·è¯†åˆ«æµç¨‹

### æ­¥éª¤1ï¼šç”¨æˆ·ç™»å½•ï¼ˆSupabase Authï¼‰
```typescript
// å‰ç«¯ï¼šç”¨æˆ·ç™»å½•
const { user } = await supabase.auth.signIn()
// è·å¾—ï¼šuser.id = "9dee4891-89a6-44ee-8fe8-69097846e97d"
```

### æ­¥éª¤2ï¼šç”Ÿæˆå”¯ä¸€xhsUserId
```typescript
// å‰ç«¯ï¼šè°ƒç”¨æ˜ å°„æœåŠ¡
const xhsUserId = await userMappingService.getOrCreateMapping(user.id)
// ç”Ÿæˆï¼šxhsUserId = "user_9dee489189a644ee_prome"
```

**æ˜ å°„è§„åˆ™ï¼š**
```
Supabase UUID: 9dee4891-89a6-44ee-8fe8-69097846e97d
    â†“ (å»æ‰æ¨ªæ )
    9dee489189a644ee8fe869097846e97d
    â†“ (å–å‰16ä½)
    9dee489189a644ee
    â†“ (æ·»åŠ å‰ç¼€å’Œåç¼€)
    user_9dee489189a644ee_prome
```

### æ­¥éª¤3ï¼šå­˜å‚¨æ˜ å°„å…³ç³»ï¼ˆSupabaseï¼‰
```sql
-- xhs_user_mappings è¡¨
supabase_uuid                           | xhs_user_id
----------------------------------------|---------------------------
9dee4891-89a6-44ee-8fe8-69097846e97d   | user_9dee489189a644ee_prome
7abc1234-56ef-7890-abcd-ef1234567890   | user_7abc123456ef7890_prome
```

---

## 2. æ•°æ®éš”ç¦»æœºåˆ¶

### åç«¯å­˜å‚¨ç»“æ„ï¼ˆGoï¼‰
```go
// å†…å­˜Mapå­˜å‚¨ï¼ˆæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ï¼‰
type AutoService struct {
    userPlans      map[string]*WeeklyPlan      // key: userId
    userStrategies map[string]*ContentStrategy // key: userId
    userStatus     map[string]*AutoStatus      // key: userId
    userCookies    map[string]*Cookies         // key: userId
}
```

### æ–‡ä»¶å­˜å‚¨ç»“æ„
```bash
/app/data/
â”œâ”€â”€ user_9dee489189a644ee_prome/
â”‚   â”œâ”€â”€ plan.json          # ç”¨æˆ·Açš„æ•°æ®
â”‚   â”œâ”€â”€ strategy.json
â”‚   â””â”€â”€ status.json
â”‚
â”œâ”€â”€ user_7abc123456ef7890_prome/
â”‚   â”œâ”€â”€ plan.json          # ç”¨æˆ·Bçš„æ•°æ®
â”‚   â”œâ”€â”€ strategy.json
â”‚   â””â”€â”€ status.json
```

---

## 3. APIè¯·æ±‚æµç¨‹

```
ç”¨æˆ·Aå‰ç«¯                                       åç«¯æœåŠ¡å™¨
    â”‚
    â”‚  GET /agent/auto/plan/user_9dee489189a644ee_prome
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
    â”‚                                              â”‚
    â”‚                                         è§£æuserId
    â”‚                                         æŸ¥æ‰¾ç”¨æˆ·Aæ•°æ®
    â”‚                                              â”‚
    â”‚  â† è¿”å›ç”¨æˆ·Açš„planï¼ˆ7ä¸ªä»»åŠ¡ï¼‰               â”‚
    â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

**æ•°æ®éš”ç¦»ä¿è¯ï¼š**
- âœ… ç”¨æˆ·Aåªèƒ½è®¿é—® `user_A` çš„æ•°æ®
- âœ… ç”¨æˆ·Båªèƒ½è®¿é—® `user_B` çš„æ•°æ®
- âŒ ç”¨æˆ·Aæ— æ³•è®¿é—®ç”¨æˆ·Bçš„æ•°æ®ï¼ˆä¸åŒuserIdï¼‰

---

## 4. æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ï¼ˆReactï¼‰                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ç”¨æˆ·A    â”‚  â”‚ ç”¨æˆ·B    â”‚  â”‚ ç”¨æˆ·C    â”‚             â”‚
â”‚  â”‚ UUID: A  â”‚  â”‚ UUID: B  â”‚  â”‚ UUID: C  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â”‚ (æ˜ å°„æœåŠ¡)  â”‚             â”‚
        â†“             â†“             â†“
    user_A        user_B        user_C
        â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â†“             â†“             â†“                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ æ•°æ®A   â”‚  â”‚ æ•°æ®B   â”‚  â”‚ æ•°æ®C   â”‚   åç«¯æœåŠ¡å™¨   â”‚
â”‚  â”‚ Map[A]  â”‚  â”‚ Map[B]  â”‚  â”‚ Map[C]  â”‚   (Go)        â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â”‚
â”‚       â†“            â†“            â†“                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ fileA   â”‚  â”‚ fileB   â”‚  â”‚ fileC   â”‚   æ–‡ä»¶å­˜å‚¨     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. èŒè´£åˆ†å·¥

### SupabaseèŒè´£
- âœ… ç”¨æˆ·è®¤è¯ï¼ˆAuthï¼‰
- âœ… ç”¨æˆ·UUIDç”Ÿæˆ
- âœ… ç”¨æˆ·æ˜ å°„è¡¨ï¼ˆUUID â†” xhsUserIdï¼‰
- âŒ è¿è¥æ•°æ®å­˜å‚¨ï¼ˆå·²åºŸå¼ƒï¼‰

### åç«¯æœåŠ¡å™¨èŒè´£
- âœ… è¿è¥æ•°æ®å­˜å‚¨ï¼ˆå”¯ä¸€æ•°æ®æºï¼‰
- âœ… Plan/Strategy/Status ç®¡ç†
- âœ… Cookieç®¡ç†
- âœ… å†…å®¹ç”Ÿæˆ
- âœ… è‡ªåŠ¨å‘å¸ƒ
- âœ… å¤šç”¨æˆ·éš”ç¦»

### å‰ç«¯èŒè´£
- âœ… ç”¨æˆ·ç™»å½•/è®¤è¯
- âœ… è·å–xhsUserId
- âœ… è°ƒç”¨åç«¯API
- âœ… å±•ç¤ºæ•°æ®
- âŒ æ•°æ®å­˜å‚¨ï¼ˆä¸å†ä½¿ç”¨Supabaseï¼‰

---

## 6. å¤šç”¨æˆ·å¹¶å‘åœºæ™¯

### åœºæ™¯1ï¼šåŒæ—¶å¯åŠ¨è¿è¥
```
æ—¶é—´      ç”¨æˆ·A                ç”¨æˆ·B                ç”¨æˆ·C
10:00  å¯åŠ¨è¿è¥              -                    -
10:01  ç”Ÿæˆä¸­...            å¯åŠ¨è¿è¥              -
10:02  å®Œæˆâœ…               ç”Ÿæˆä¸­...            å¯åŠ¨è¿è¥
10:03  -                   å®Œæˆâœ…               ç”Ÿæˆä¸­...
10:04  -                   -                    å®Œæˆâœ…
```

**ç»“æœï¼š**
- ç”¨æˆ·A: 7ä¸ªä»»åŠ¡ï¼ˆç‹¬ç«‹å­˜å‚¨ï¼‰
- ç”¨æˆ·B: 5ä¸ªä»»åŠ¡ï¼ˆç‹¬ç«‹å­˜å‚¨ï¼‰
- ç”¨æˆ·C: 6ä¸ªä»»åŠ¡ï¼ˆç‹¬ç«‹å­˜å‚¨ï¼‰
- âœ… äº’ä¸å¹²æ‰°

---

## 7. æ‰©å±•æ€§

### å½“å‰æ”¯æŒ
- **æ´»è·ƒç”¨æˆ·æ•°**: ~2000 (2GBå†…å­˜)
- **æ€»ç”¨æˆ·æ•°**: 10,000+ (æ–‡ä»¶å­˜å‚¨)

### æ‰©å±•æ–¹æ¡ˆ
1. **1000+ ç”¨æˆ·**: æ·»åŠ Redisç¼“å­˜
2. **10,000+ ç”¨æˆ·**: è¿ç§»åˆ°æ•°æ®åº“(PostgreSQL/MongoDB)
3. **100,000+ ç”¨æˆ·**: å¾®æœåŠ¡åŒ– + è´Ÿè½½å‡è¡¡

---

## 8. å®‰å…¨æ€§

### âœ… å·²å®ç°
- Supabase JWTè®¤è¯
- ç”¨æˆ·IDéš”ç¦»
- å‰ç«¯Sessionç®¡ç†

### âš ï¸ å»ºè®®åŠ å¼º
- åç«¯æƒé™éªŒè¯ï¼ˆéªŒè¯userIdå±äºå½“å‰ç”¨æˆ·ï¼‰
- API Rate Limiting
- Cookieæ•°æ®åŠ å¯†

---

## 9. å¸¸è§é—®é¢˜

**Q: ç”¨æˆ·æ•°æ®ä¼šäº’ç›¸å½±å“å—ï¼Ÿ**
A: ä¸ä¼šã€‚æ¯ä¸ªç”¨æˆ·é€šè¿‡å”¯ä¸€çš„xhsUserIdå®Œå…¨éš”ç¦»ã€‚

**Q: æœåŠ¡å™¨é‡å¯æ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿ**
A: ä¸ä¼šã€‚æ•°æ®æŒä¹…åŒ–åˆ°æ–‡ä»¶ï¼Œé‡å¯åè‡ªåŠ¨æ¢å¤ã€‚

**Q: æ”¯æŒå¤šå°‘ç”¨æˆ·ï¼Ÿ**
A: å½“å‰æ¶æ„æ”¯æŒ2000ä¸ªæ´»è·ƒç”¨æˆ·ï¼Œ10,000+æ€»ç”¨æˆ·ã€‚

**Q: å¦‚ä½•æ·»åŠ æ–°ç”¨æˆ·ï¼Ÿ**
A: è‡ªåŠ¨å¤„ç†ã€‚ç”¨æˆ·ç™»å½•åè‡ªåŠ¨åˆ›å»ºæ˜ å°„å’Œæ•°æ®ç©ºé—´ã€‚

---

## 10. æ¶æ„ä¼˜åŠ¿

âœ… **ç®€å•é«˜æ•ˆ** - å†…å­˜Mapæ€§èƒ½æé«˜
âœ… **æ•°æ®éš”ç¦»** - æ— ä¸²æ•°æ®é£é™©
âœ… **æ˜“äºæ‰©å±•** - æ·»åŠ ç”¨æˆ·æˆæœ¬ä½
âœ… **å®¹ç¾æ¢å¤** - æ–‡ä»¶æŒä¹…åŒ–
âœ… **æˆæœ¬ä½** - æ— éœ€é¢å¤–æ•°æ®åº“

---

## ç›¸å…³æ–‡æ¡£
- [APIæ–‡æ¡£](./API.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)
- [æ•…éšœæ’æŸ¥](./TROUBLESHOOTING.md)
