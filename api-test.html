<!DOCTYPE html>
<html>
<head>
    <title>ProMe API æµ‹è¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .response { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; white-space: pre-wrap; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ProMe API æµ‹è¯•å·¥å…·</h1>
        
        <h3>1. ä¿¡æ¯æ”¶é›†æµ‹è¯•</h3>
        <textarea id="productInfo" placeholder="è¾“å…¥äº§å“ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šäº§å“ï¼šAIç¼–ç¨‹åŠ©æ‰‹ã€‚ç‰¹è‰²ï¼šä»£ç ç”Ÿæˆã€bugæ£€æµ‹ã€ä¼˜åŒ–å»ºè®®ã€‚ç”¨æˆ·ï¼šç¨‹åºå‘˜ã€‚ä»·æ ¼ï¼š199å…ƒ/æœˆã€‚">äº§å“ï¼šAIç¼–ç¨‹åŠ©æ‰‹ã€‚ç‰¹è‰²ï¼šä»£ç ç”Ÿæˆã€bugæ£€æµ‹ã€ä¼˜åŒ–å»ºè®®ã€‚ç”¨æˆ·ï¼šç¨‹åºå‘˜ã€‚ä»·æ ¼ï¼š199å…ƒ/æœˆã€‚</textarea>
        <button onclick="testInfoCollection()">å¼€å§‹ä¿¡æ¯æ”¶é›†</button>
        
        <h3>2. ç—›ç‚¹ç”Ÿæˆæµ‹è¯•</h3>
        <button onclick="testPainGeneration()">å¼€å§‹ç—›ç‚¹ç”Ÿæˆ</button>
        
        <h3>3. LLM7-14å¤šèŠ‚ç‚¹æµ‹è¯•</h3>
        <textarea id="painPoint" placeholder="é€‰æ‹©ä¸€ä¸ªç—›ç‚¹å†…å®¹">æ·±å¤œåŠ ç­æ—¶ï¼Œç¨‹åºå‘˜å°æå‘ç°AIåŠ©æ‰‹ç”Ÿæˆçš„ä»£ç è™½ç„¶èƒ½è¿è¡Œï¼Œä½†æ€»æ˜¯ç¼ºå°‘é‚£ç§"ä¼˜é›…ç®€æ´"çš„æ„Ÿè§‰...</textarea>
        <button onclick="testMultiNode()">è§¦å‘LLM7-14å¤„ç†</button>
        
        <h3>ğŸ“Š å“åº”ç»“æœ</h3>
        <div id="response" class="response">ç­‰å¾…æµ‹è¯•...</div>
        
        <h3>ğŸ’° Tokenç»Ÿè®¡</h3>
        <div id="tokenStats" class="response">
            æ€»æ¶ˆè€—: <span id="totalTokens">0</span> tokens<br>
            æ€»æˆæœ¬: $<span id="totalCost">0.00</span><br>
            ä¼šè¯ID: <span id="conversationId">-</span>
        </div>
    </div>

    <script>
        let currentConversationId = '';
        let totalTokensUsed = 0;
        let totalCostAccumulated = 0;

        async function apiCall(query) {
            const response = await fetch('http://localhost:8080/api/dify', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer test-user-token'
                },
                body: JSON.stringify({
                    inputs: {},
                    query: query,
                    response_mode: 'streaming',
                    conversation_id: currentConversationId,
                    user: 'test-user',
                    files: []
                })
            });
            
            const data = await response.json();
            
            // æ›´æ–°ä¼šè¯ID
            if (data.conversation_id) {
                currentConversationId = data.conversation_id;
                document.getElementById('conversationId').textContent = currentConversationId;
            }
            
            // æ›´æ–°Tokenç»Ÿè®¡
            if (data.metadata && data.metadata.usage) {
                const tokens = data.metadata.usage.total_tokens || 0;
                const cost = parseFloat(data.metadata.usage.total_price || 0);
                totalTokensUsed += tokens;
                totalCostAccumulated += cost;
                
                document.getElementById('totalTokens').textContent = totalTokensUsed.toLocaleString();
                document.getElementById('totalCost').textContent = totalCostAccumulated.toFixed(6);
            }
            
            return data;
        }

        async function testInfoCollection() {
            const productInfo = document.getElementById('productInfo').value;
            try {
                showResponse('ğŸ”„ å‘é€äº§å“ä¿¡æ¯...', 'info');
                const result = await apiCall(productInfo);
                showResponse(`âœ… ä¿¡æ¯æ”¶é›†å“åº”:\n${result.answer}`, 'success');
                
                // å¦‚æœéœ€è¦è¡¥å……ä¿¡æ¯
                if (result.answer.includes('è¯·å‘ŠçŸ¥') || result.answer.includes('ç¼ºå¤±')) {
                    setTimeout(async () => {
                        showResponse('ğŸ”„ è¡¥å……æ–‡æ¡ˆå­—æ•°è¦æ±‚...', 'info');
                        const wordCountResult = await apiCall('æ–‡æ¡ˆå­—æ•°ï¼š800å­—');
                        showResponse(`âœ… è¡¥å……ä¿¡æ¯å“åº”:\n${wordCountResult.answer}`, 'success');
                    }, 2000);
                }
            } catch (error) {
                showResponse(`âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testPainGeneration() {
            try {
                showResponse('ğŸ”„ å¼€å§‹ç—›ç‚¹ç”Ÿæˆ...', 'info');
                const result = await apiCall('å¼€å§‹ç—›ç‚¹ç”Ÿæˆ');
                showResponse(`âœ… ç—›ç‚¹ç”Ÿæˆå“åº”:\n${result.answer}`, 'success');
            } catch (error) {
                showResponse(`âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testMultiNode() {
            const painPoint = document.getElementById('painPoint').value;
            try {
                showResponse('ğŸ”„ é€‰æ‹©ç—›ç‚¹...', 'info');
                const selectResult = await apiCall(painPoint);
                showResponse(`âœ… ç—›ç‚¹é€‰æ‹©å“åº”:\n${selectResult.answer}`, 'success');
                
                setTimeout(async () => {
                    showResponse('ğŸš€ è§¦å‘LLM7-14å¤šèŠ‚ç‚¹å¤„ç†...', 'info');
                    const biubiuResult = await apiCall('biubiu');
                    showResponse(`ğŸ¯ LLM7-14å¤„ç†å®Œæˆ!\nå“åº”é•¿åº¦: ${biubiuResult.answer?.length || 0} å­—ç¬¦\nå†…å®¹é¢„è§ˆ: ${biubiuResult.answer?.substring(0, 500)}...`, 'success');
                }, 3000);
            } catch (error) {
                showResponse(`âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function showResponse(text, type = 'info') {
            const responseDiv = document.getElementById('response');
            responseDiv.textContent = text;
            responseDiv.className = `response ${type}`;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            showResponse('ğŸ¯ ProMe API æµ‹è¯•å·¥å…·å·²å‡†å¤‡å°±ç»ª!\n\nä½¿ç”¨è¯´æ˜:\n1. å…ˆæµ‹è¯•ä¿¡æ¯æ”¶é›† - è¾“å…¥äº§å“ä¿¡æ¯\n2. ç„¶åæµ‹è¯•ç—›ç‚¹ç”Ÿæˆ - ä¼šç”Ÿæˆ3ä¸ªç—›ç‚¹é€‰é¡¹\n3. æœ€åæµ‹è¯•LLM7-14 - é€‰æ‹©ç—›ç‚¹å¹¶è§¦å‘å¤šèŠ‚ç‚¹å¤„ç†\n\næ¯ä¸ªæ­¥éª¤ä¼šæ˜¾ç¤ºTokenæ¶ˆè€—ç»Ÿè®¡ã€‚', 'info');
        };
    </script>
</body>
</html>