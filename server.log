[dotenv@17.2.1] injecting env (12) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
ğŸš€ Starting Prome Platform server
âœ… Dify API environment variables are configured
Server is running on port 3001
ğŸ” Performing database health check...
âœ… Database health check passed - all required tables exist
ğŸ” INCOMING REQUEST: POST /api/dify/test-conversation-id
ğŸ—£ï¸ NON-STREAM /:conversationId ENDPOINT CALLED with: test-conversation-id
ğŸ” Non-stream endpoint processing conversation: test-conversation-id
ğŸ”§ Generated new UUID for invalid conversation ID: test-conversation-id -> 36787c09-aba2-4fae-816f-6b16a0beda92
ğŸ†• Creating conversation record for: 36787c09-aba2-4fae-816f-6b16a0beda92
ğŸ”§ Generated anonymous user ID: d521831f-5b43-4bb3-b86c-8120086a8624
ğŸ” ensureConversationExists called with: {
  conversationId: '36787c09-aba2-4fae-816f-6b16a0beda92',
  difyConversationId: null,
  userId: 'd521831f-5b43-4bb3-b86c-8120086a8624',
  hasSupabase: true
}
âš ï¸ User not found in database, creating conversation without user_id: d521831f-5b43-4bb3-b86c-8120086a8624
âœ… Created new conversation record
ğŸ”§ Generated anonymous user ID: db3916ce-3cc7-49a4-8b3c-6f36dcf1f608
âš ï¸ No existing DIFY conversation ID found, will create new conversation
ğŸ”§ FIXED: Using chat-messages API to maintain conversation state for ChatFlow
ğŸ¯ INTELLIGENT STATE ANALYSIS - REGULAR:
   ğŸ§  Detected Stage: initial
   ğŸ¯ Confidence: 0.7
   ğŸ“Š User Message Count: 1
   ğŸ” Detected Intents: { initial: false, selection: false, confirmation: false }
   ğŸ§® Logical Count: 0
ğŸ”„ æ–°å¯¹è¯æ£€æµ‹åˆ°ï¼Œå‘é€é¢„çƒ­æ¶ˆæ¯æ¶ˆè€—å¼€åœºç™½çš„dialogue_count=0
ğŸ”§ Generated anonymous user ID: 2b274d92-5901-4836-9728-6aa27acd60f1
âš ï¸ é¢„çƒ­æ¶ˆæ¯å¤±è´¥ï¼Œç»§ç»­åŸè¯·æ±‚: ReferenceError: STANDARD_TIMEOUT is not defined
    at file:///Users/boliu/prome-platform/server.js:1870:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
   ğŸ§  Detected Stage: initial (Confidence: 0.7)
   ğŸ” Intents: { initial: false, selection: false, confirmation: false }
ğŸ” API Debug Info:
   Endpoint: https://api.dify.ai/v1/chat-messages
   Local conversation ID: 36787c09-aba2-4fae-816f-6b16a0beda92
   DIFY conversation ID: null
   Request body: {
  "inputs": {},
  "query": "hello",
  "response_mode": "blocking",
  "user": "db3916ce-3cc7-49a4-8b3c-6f36dcf1f608"
}
âš ï¸ No conversation ID in request - will create new conversation
ğŸ”§ Generated anonymous user ID: 01dc4a8d-3033-495a-b2ac-b7756680956e
ğŸ” ensureConversationExists called with: {
  conversationId: '36787c09-aba2-4fae-816f-6b16a0beda92',
  difyConversationId: '56b2dd1b-f5f9-4c13-827d-110a57f40fcb',
  userId: '01dc4a8d-3033-495a-b2ac-b7756680956e',
  hasSupabase: true
}
âœ… Updated conversation mapping with Dify ID
âœ… Messages saved successfully
