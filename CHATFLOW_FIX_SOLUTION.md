# ChatFlow修复方案

## 问题诊断
您的DIFY ChatFlow配置为营销文案生成工作流，包含：
- 起始节点 → document-extractor → 复杂的营销分析流程
- 总是返回结构化JSON输出（identified_antithesis, target_words等）
- 无法进行正常对话

## 解决方案选项

### 方案1：修改现有ChatFlow（推荐）
在现有营销ChatFlow开头添加条件判断：

1. **添加条件节点**：检查用户输入是否包含营销关键词
2. **双路径设计**：
   - 路径A：营销文案生成（现有流程）
   - 路径B：正常对话（新增LLM节点）

### 方案2：创建新的简单ChatFlow
创建一个只包含LLM节点的简单对话流程

### 方案3：使用Chat应用类型
将应用类型从advanced-chat改为chat

## 推荐实施方案1的具体步骤

### 1. 修改ChatFlow结构
```yaml
开始节点 → 条件判断节点 → 分支：
├── 营销模式：document-extractor → 现有营销流程
└── 对话模式：LLM节点（正常对话）
```

### 2. 条件判断逻辑
检查用户输入是否包含：
- "营销文案"、"文案"、"营销"
- "分析"、"广告"、"推广"
- 或上传了文件

### 3. 正常对话LLM配置
- 模型：claude-3-5-sonnet 或 gpt-4
- 系统提示：正常对话助手角色
- 流式输出：启用

## 临时解决方案（立即可用）

可以先创建一个新的简单Chat应用用于正常对话，保留现有的营销ChatFlow。

## 需要的操作
1. 登录DIFY控制台
2. 修改现有ChatFlow或创建新应用
3. 更新前端配置（如需切换应用）
4. 测试两种模式的功能